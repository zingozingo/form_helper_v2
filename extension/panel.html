<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Form Helper</title>
    <link rel="stylesheet" href="lib/material-icons.css">
    <script src="lib/marked.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Original Sidebar Panel UI Styling -->
    <style>
        :root {
            --primary-color: #4285F4;
            --primary-dark: #3367D6;
            --secondary-color: #34A853;
            --error-color: #EA4335;
            --warning-color: #FBBC05;
            --neutral-50: #F8F9FA;
            --neutral-100: #F1F3F4;
            --neutral-200: #E8EAED;
            --neutral-300: #DADCE0;
            --neutral-700: #5F6368;
            --neutral-900: #202124;
            --border-radius: 4px;
            --box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            --transition-speed: 0.2s;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--neutral-900);
            background: white;
            overflow: hidden;
            height: 100vh;
        }
        
        .sidebar-panel {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            background: white;
            border-left: 1px solid var(--neutral-200);
        }
        
        .sidebar-header {
            padding: 12px 16px;
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .field-count {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: 6px;
        }
        
        .sidebar-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--neutral-200);
        }
        
        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--neutral-300);
            border-radius: var(--border-radius);
            font-size: 14px;
        }
        
        .fields-container {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        
        .field-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-bottom: 6px;
            border: 1px solid transparent;
            transition: all var(--transition-speed) ease;
        }
        
        .field-item:hover {
            background-color: var(--neutral-50);
            border-color: var(--neutral-200);
        }
        
        .field-item.selected {
            background-color: rgba(66, 133, 244, 0.08);
            border-color: var(--primary-color);
        }
        
        .field-icon-container {
            position: relative;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .field-icon {
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .confidence-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .confidence-high {
            background-color: var(--secondary-color);
        }
        
        .confidence-medium {
            background-color: var(--warning-color);
        }
        
        .confidence-low {
            background-color: var(--error-color);
        }
        
        .field-details {
            flex: 1;
            min-width: 0;
        }
        
        .field-name {
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .field-type {
            color: var(--neutral-700);
            font-size: 12px;
            display: flex;
            align-items: center;
        }
        
        .field-type i {
            font-size: 14px;
            margin-right: 4px;
        }
        
        .required-badge {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--error-color);
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 6px;
        }
        
        .confidence-text {
            font-size: 10px;
            margin-left: 6px;
            padding: 1px 4px;
            border-radius: 3px;
        }
        
        .confidence-text.confidence-high {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }
        
        .confidence-text.confidence-medium {
            background-color: rgba(251, 188, 5, 0.1);
            color: #996c05;
        }
        
        .confidence-text.confidence-low {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--error-color);
        }
        
        .conversation-container {
            flex: 2;
            display: flex;
            flex-direction: column;
            border-top: 1px solid var(--neutral-200);
        }
        
        .conversation-header {
            padding: 12px 16px;
            background-color: var(--neutral-50);
            border-bottom: 1px solid var(--neutral-200);
            font-weight: 500;
        }
        
        .active-field-name {
            color: var(--primary-color);
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background-color: white;
        }
        
        .message {
            display: flex;
            margin-bottom: 20px;
        }
        
        .user-message {
            justify-content: flex-end;
        }
        
        .ai-message {
            justify-content: flex-start;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            background-color: var(--neutral-200);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .user-message .message-avatar {
            order: 2;
            margin-right: 0;
            margin-left: 12px;
            background-color: var(--primary-color);
            color: white;
        }
        
        .message-content {
            max-width: 85%;
            padding: 12px;
            border-radius: 12px;
            background-color: var(--neutral-100);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .user-message .message-content {
            background-color: var(--primary-color);
            color: white;
        }
        
        .system-message {
            text-align: center;
            margin: 16px 0;
            color: var(--neutral-700);
            font-style: italic;
            font-size: 12px;
        }
        
        .message-timestamp {
            font-size: 10px;
            color: var(--neutral-700);
            margin-top: 4px;
            text-align: right;
        }
        
        .user-message .message-timestamp {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .input-container {
            padding: 12px 16px;
            border-top: 1px solid var(--neutral-200);
            display: flex;
            background-color: white;
        }
        
        .message-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--neutral-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            resize: none;
            max-height: 120px;
            min-height: 40px;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            cursor: pointer;
            border: none;
        }
        
        .footer {
            padding: 16px;
            border-top: 1px solid var(--neutral-200);
            display: flex;
            justify-content: space-between;
            background-color: white;
        }
        
        .autofill-button {
            flex: 1;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color var(--transition-speed) ease;
        }
        
        .autofill-button:hover {
            background-color: var(--primary-dark);
        }
        
        .typing-indicator {
            display: none;
            padding: 12px;
            margin: 0 0 16px 44px;
        }
        
        .typing-indicator.visible {
            display: flex;
        }
        
        .typing-dot {
            background-color: var(--neutral-300);
            width: 8px;
            height: 8px;
            border-radius: 4px;
            margin: 0 3px;
            animation: typing-animation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing-animation {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-appeared .fields-container {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        /* Icon button hover effects */
        #help-button:hover, #close-panel:hover {
            opacity: 1 !important;
            background: rgba(255,255,255,0.3) !important;
            transform: scale(1.1);
            transition: all 0.2s ease;
        }
        
        /* Debug message (hidden by default) */
        .debug-message {
            display: none !important;
        }
        
        /* Emergency button styling */
        .emergency-button {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            z-index: 2147483647 !important;
            width: 60px !important;
            height: 60px !important;
            background-color: #EA4335 !important;
            color: white !important;
            border-radius: 50% !important;
            display: none !important; /* Hidden by default */
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
            font-size: 20px !important;
            border: 3px solid white !important;
        }
    </style>
</head>
<body>
    <!-- Debug message - hidden by default -->
    <div class="debug-message" style="display:none">
        <p><strong>Keyboard shortcuts:</strong></p>
        <ol>
            <p>1. Press Alt+A to autofill the form via keyboard shortcut</p>
            <p>2. Press Alt+F to focus on fields panel</p>
        </ol>
    </div>
    
    <div class="sidebar-panel" id="sidebar-panel">
        <div class="sidebar-header">
            <div class="sidebar-title">
                <i class="material-icons">article</i>
                <span>FORM FIELDS</span>
                <span class="field-count" id="field-count">0</span>
            </div>
            <div style="display:flex; gap:8px;">
                <i class="material-icons" id="help-button" style="cursor:pointer; opacity:0.8; font-size:20px; background:rgba(255,255,255,0.2); border-radius:50%; padding:4px;">help_outline</i>
                <i class="material-icons" id="close-panel" style="cursor:pointer; opacity:0.8; font-size:20px; background:rgba(255,255,255,0.2); border-radius:50%; padding:4px;">close</i>
            </div>
        </div>
        
        <div class="sidebar-search">
            <input type="text" class="search-input" id="search-input" placeholder="Type your search here...">
        </div>
        
        <div class="fields-container" id="fields-container">
            <!-- Fields will be populated here -->
        </div>
        
        <div class="conversation-container" id="conversation-container">
            <div class="conversation-header">
                <span>Field: <span class="active-field-name" id="active-field-name">None selected</span></span>
            </div>
            
            <div class="messages-container" id="messages-container">
                <!-- Welcome message -->
                <div class="message ai-message">
                    <div class="message-avatar">
                        <i class="material-icons">smart_toy</i>
                    </div>
                    <div class="message-content">
                        Hello! I'm your form assistant. Select a field to learn more, or ask me a question about this form.
                    </div>
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="input-container">
                <textarea class="message-input" id="message-input" placeholder="Ask about this form..."></textarea>
                <button class="send-button" id="send-button">
                    <i class="material-icons">send</i>
                </button>
            </div>
        </div>
        
        <div class="footer">
            <button class="autofill-button" id="autofill-button">
                <i class="material-icons">auto_fix_high</i>
                <span>Auto-fill Form</span>
            </button>
        </div>
    </div>
    
    <!-- Shortcuts Help Modal -->
    <div id="shortcuts-modal" class="modal" aria-hidden="true" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;">
        <div class="modal-content" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:400px; background:white; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.2);">
            <div class="modal-header" style="padding:16px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <h3 id="shortcuts-title" style="margin:0; font-weight:500;">Keyboard Shortcuts</h3>
                <button class="close-button" aria-label="Close shortcuts dialog" style="background:none; border:none; cursor:pointer;">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body" style="padding:16px;">
                <div style="display:grid; grid-template-columns:auto 1fr; gap:12px; row-gap:16px;">
                    <div><kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">Alt</kbd> + <kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">F</kbd></div>
                    <div>Focus on fields list</div>
                    
                    <div><kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">Alt</kbd> + <kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">C</kbd></div>
                    <div>Focus on chat input</div>
                    
                    <div><kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">Alt</kbd> + <kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">A</kbd></div>
                    <div>Auto-fill form</div>
                    
                    <div><kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">?</kbd></div>
                    <div>Show this help dialog</div>
                    
                    <div><kbd style="background:#eee; border:1px solid #ccc; border-radius:3px; padding:2px 6px;">Esc</kbd></div>
                    <div>Close dialogs</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating emergency fallback button - HIDDEN -->
    <div id="emergency-button" class="emergency-button">
        <i class="material-icons">flash_on</i>
    </div>
    
    <!-- Helper scripts -->
    <script src="lib/panel-helpers.js"></script>
    
    <!-- Fix-layout script to ensure proper layout -->
    <script src="fix-layout.js"></script>
    
    <!-- Button visibility fix script -->
    <script src="button-visibility-fix.js"></script>
    
    <!-- Main panel script -->
    <script src="panel.js"></script>
</body>
</html>